<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">

<div id="thread-view" class="container d-flex justify-content-center align-items-center">

    <div class="row">

        <th:block th:object="${thread}">
            <div id="news" class="col-xs-6">


                <!--

                THREAD

                -->

                <div class="card">
                    <div class="card-header">
                        <div class="row">
                            <div class="col-md-4">
                                <div align="center">
                                    <small>üë§<a href="" th:text="*{creatorUsername}"></a></small>
                                </div>
                                <div align="center">
                                    <img style="width: 50px;height: 50px;max-width: 100%;" class="card-img-top "
                                         src="/res/img/navbar-icon.png" alt="Card image cap">
                                </div>
                                <div align="center">
                                    <small>
                                        <small>üí¨</small>
                                        <span class="totalComments" th:text="*{creatorTotalComments}"></span> total
                                        comments
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div align="center">
                                    <div class="row">

                                        <small>
                                            <a href=""><img style="width: 15px;height: 15px;max-width: 100%;"
                                                            class="card-img-top "
                                                            src="/res/img/navbar-icon.png" alt="Card image cap"><span>Minecraft Username</span></a>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <h3 class="title" th:text="*{title}"></h3>
                            </div>
                            <div class="col-md-4">
                                <small style="display: inline-block;padding-top: 18px;float:right;">
                                    <small class="dateIcon">üìÖ</small>
                                    <small class="date"
                                           th:text="*{#temporals.format(createdOn, 'dd MMM,yyyy')}"></small>
                                </small>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-8">
                                <small>by <a href="/SMENI">üë§<span class="user" th:text="*{creatorUsername}"></span></a>
                                    at
                                    <span
                                            class="postTime" th:text="*{#temporals.format(createdOn, 'HH:mm')}"></span>
                                    <th:block sec:authorize="isAnonymous()">
                                        (<span
                                            class="totalViews" th:text="*{totalViews}">0</span>üëÄ / <span
                                            class="totalLikes" th:text="*{totalReactions}">0</span>üëç)
                                    </th:block>
                                    <th:block sec:authorize="isAuthenticated()">
                                        <th:block sec:authorize="hasAuthority('MODERATOR')">
                                            (<a href="/SAMO AKO IMA PRAVA"><span
                                                class="totalViews" th:text="*{totalViews}">0</span></a>üëÄ / <a
                                                href="/SAMO AKO IMA PRAVA"><span
                                                class="totalLikes" th:text="*{totalReactions}">0</span></a>üëç)
                                        </th:block>
                                        <th:block sec:authorize="!hasAuthority('MODERATOR')">
                                            (<span
                                                class="totalViews" th:text="*{totalViews}">0</span>üëÄ / <span
                                                class="totalLikes" th:text="*{totalReactions}">0</span>üëç)
                                        </th:block>
                                    </th:block>
                                </small>
                            </div>
                            <div class="col-md-4">
                                <small style="display: inline-block;padding-top: 18px;float:right;">
                                    <small>üí¨</small>
                                    <a href="/SMENI"><span class="totalComments" th:text="*{totalComments}"></span></a>
                                    Comments
                                </small>
                            </div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="content" th:id="'content' + ${thread.getId()}">
                            <p class="card-text" style="width: 60vw;min-width: 230px" th:utext="*{content}">

                            </p>
                        </div>

                        <!--

                        Clears the keyword SHOW_TO_NOW:

                        -->
                        <script th:inline="javascript">
                            proceed();

                            function proceed() {

                                let content = $(`#content` + [[${thread.getId()}]])[0].innerHTML;
                                let substringedContent = content.substring(0, content.indexOf('SHOW_TO_NOW'));
                                let isFound = substringedContent !== '';

                                if (isFound) {
                                    $(`#content` + [[${thread.getId()}]]).empty();

                                    let result = content.replace('SHOW_TO_NOW', '');

                                    $(`#content` + [[${thread.getId()}]]).append(result);
                                }
                            }
                        </script>


                        <div class="row">
                            <div class="col-md-8" style="margin-bottom: 8px">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="btn-group">
                                    <th:block sec:authorize="isAuthenticated()">
                                        <th:block sec:authorize="hasAuthority('MODERATOR')">
                                            <button class="btn btn-secondary btn-sm dropdown-toggle" type="button"
                                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <small>‚öô</small>
                                                Options
                                            </button>
                                            <div class="dropdown-menu">
                                                <th:block sec:authorize="hasAuthority('ADMIN')">
                                                    <a class="dropdown-item" th:href="@{/thread/{id}/delete(id=*{id})}">
                                                        <small>‚ùå</small>
                                                        Delete</a>
                                                </th:block>
                                            </div>
                                        </th:block>
                                    </th:block>
                                    <a th:href="@{/thread/{id}/report(id=*{id})}">
                                        <button class="btn btn-sm" type="button" style="margin-left: 5px">
                                            <small>‚ö†</small>
                                            Report
                                        </button>
                                    </a>
                                </div>
                                <div class="btn-group" style="display: inline-block;float:right">
                                    <button id="button-commentThread-readThreadPage" class="btn btn-sm" type="button"
                                            aria-haspopup="true" aria-expanded="false">
                                        <small>üí¨</small>
                                        Comment
                                    </button>
                                    <button class="btn btn-sm dropdown-toggle" type="button"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <small>üí°</small>
                                        React
                                    </button>
                                    <div class="dropdown-menu">
                                        <a th:href="@{/thread/{id}/reaction/like(id=*{id})}">
                                            <button class="btn btn-sm" type="button" style="margin-left: 10px">
                                                <small>üëçüèª</small>
                                                Like
                                            </button>
                                        </a>
                                        <a th:href="@{/thread/{id}/reaction/dislike(id=*{id})}">
                                            <button class="btn btn-sm" type="button">
                                                <small>üëéüèª</small>
                                                Dislike
                                            </button>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!--

                COMMENTS

                -->

                <div class="commentBox" style="margin-top: 25px;margin-bottom: 25px;display: none">

                    <th:block th:insert="editor/text-editor"></th:block>

                    <div id="textarea-content-createComment"
                         style=" border: 1px solid #ccc;border-radius: 3px;width: 100%;min-width: 230px;min-height: 25vw;max-height: 25vw;overflow: auto;"
                         contenteditable="true">

                    </div>
                    <div class="row d-flex justify-content-center align-items-center" style="margin-top: 10px">
                        <button id="button-createCommentThread-readThreadPage" class="btn btn-sm" type="button">
                            Comment
                        </button>
                        <button id="button-cancelCommentThread-readThreadPage" class="btn btn-sm" type="button"
                                style="margin-left: 10px">
                            Cancel
                        </button>
                    </div>
                </div>

                <script>
                    $(`#button-commentThread-readThreadPage`).on(`click`, function () {
                        $(`.commentBox`).show();
                    });

                    $(`#button-cancelCommentThread-readThreadPage`).on(`click`, function () {
                        $(`.commentBox`).hide();
                    });
                </script>

                <script th:inline="javascript">
                    let threadId = /*[[*{id}]]*/ null;
                    let buttonCreateComment = $(`#button-createCommentThread-readThreadPage`);
                    let contentDiv = $(`#textarea-content-createComment`);
                    let url = URL_API_COMMENT_THREAD.replace('{id}', threadId);
                    let successfulRedirectUrl = URL_READ_THREAD.replace('{id}', threadId);


                    buttonCreateComment.on(`click`, function () {
                        $.ajax({
                            method: "POST",
                            url: url,
                            data: {content: contentDiv.html()},
                            success: function (isSuccessful) {
                                if (isSuccessful) {
                                    window.location.href = successfulRedirectUrl;
                                }
                            }
                        });
                    });
                </script>

                <script src="/res/js/editor/text-editor.js"></script>

                <th:block th:each="comment : *{comments}" th:object="${comment}">

                    <div class="card comment" style="margin-top: 20px; margin-bottom: 20px">
                        <div class="row">
                            <div class="col-md-3" style="margin-left: 30px;margin-top: 30px">
                                <div>
                                    <img style="width: 50px;height: 50px;max-width: 100%;" class="card-img-top "
                                         src="/res/img/avatar-user.png" alt="Card image cap">
                                </div>
                                <div>
                                    <small>üë§<a href="" th:text="*{creatorUsername}"></a></small>
                                </div>
                                <div>
                                    <small>
                                        <small>üí¨</small>
                                        <span class="totalComments" th:text="*{creatorTotalComments}"></span> total
                                        comments
                                    </small>
                                </div>
                                <div>
                                    <small>
                                        <a href=""><img style="width: 15px;height: 15px;max-width: 100%;"
                                                        class="card-img-top "
                                                        src="/res/img/avatar-test.png" alt="Card image cap"><span>Minecraft Username</span></a>
                                    </small>
                                </div>
                            </div>
                            <div class="content" style="margin-left: 15px;margin-right: 15px">
                                <p class="card-text" th:utext="*{content}">

                                </p>
                            </div>

                        </div>

                        <div>
                            <div class="btn-group" style="display: inline-block;float:right;margin-bottom: 10px;margin-right: 15px;margin-top: 10px">
                                <div style="display: inline-block">
                                    <button class="btn btn-sm dropdown-toggle" type="button"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <small>‚öô</small>
                                        Options
                                    </button>
                                    <div class="dropdown-menu">
                                        <a class="dropdown-item" th:href="@{/comment/{id}/delete(id=*{id})}">
                                            <small>‚ùå</small>
                                            Delete</a>
                                    </div>
                                </div>
                                <div style="display: inline-block">

                                    <button class="btn btn-sm" type="button" id="reportButtonByThreadId">
                                        <small>‚ö†</small>
                                        Report
                                    </button>

                                    <div class="modal fade" id="modelReportCommentByThreadId" role="dialog">
                                        <div class="modal-dialog">

                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h4 class="modal-title">Report to the kings:</h4>
                                                </div>
                                                <form method="post" action="/comment/id/report">
                                                    <div class="modal-body">
                                        <textarea style="width: 100%;overflow-y: scroll;height: 200px;resize: none"
                                                  name="reason" placeholder="Reason..."></textarea>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="submit" class="btn btn-default">Report</button>
                                                        <button type="button" class="btn btn-default" data-dismiss="modal">
                                                            Cancel
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>

                                        </div>
                                    </div>
                                    <script>
                                        $(document).ready(function () {
                                            $("#reportButtonByThreadId").click(function () {
                                                $("#modelReportCommentByThreadId").modal();
                                            });
                                        });
                                    </script>
                                </div>
                                <div style="display: inline-block">
                                    <button class="btn btn-sm dropdown-toggle" type="button"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <small>üí°</small>
                                        React
                                    </button>
                                    <div class="dropdown-menu">
                                        <a th:href="@{/comment/{id}/reaction/like(id=*{id})}">
                                            <button class="btn btn-sm" type="button" style="margin-left: 10px">
                                                <small>üëçüèª</small>
                                                Like
                                            </button>
                                        </a>
                                        <a th:href="@{/comment/{id}/reaction/dislike(id=*{id})}">
                                            <button class="btn btn-sm" type="button">
                                                <small>üëéüèª</small>
                                                Dislike
                                            </button>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </th:block>

            </div>
        </th:block>

        <script src="/res/js/utils/imageFitter.js"/>

        <th:block th:insert="navbar/right-base-navbar"></th:block>

    </div>
</div>

