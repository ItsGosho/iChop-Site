<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">

<link rel="stylesheet" href="/res/css/thread/thread-read.css">

<div id="thread-view" class="container d-flex justify-content-center align-items-center">
    <div class="row">

        <th:block th:object="${thread}">
            <div class="col-xs-6">


                <!--Thread section-->

                <div class="card thread">
                    <div class="card-header">
                        <div class="row">
                            <div class="col-md-4">
                                <div align="center">
                                    <small>üë§<a href="" th:text="*{creatorUsername}"></a></small>
                                </div>
                                <div align="center">
                                    <img class="card-img-top thread-creator-avatar"
                                         src="/res/img/navbar-icon.png" alt="Card image cap">
                                </div>
                                <div align="center">
                                    <small>
                                        <small>üí¨</small>
                                        <span class="totalComments" th:text="*{creatorTotalComments}"></span> total
                                        comments
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div align="center">
                                    <div class="row">

                                        <small>
                                            <a href=""><img class="card-img-top thread-creator-minecraft_username"
                                                            src="/res/img/navbar-icon.png" alt="Card image cap"><span>Minecraft Username</span></a>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <h3 class="title" th:text="*{title}"></h3>
                            </div>
                            <div class="col-md-4">
                                <small class="thread-createdOn">
                                    <small class="dateIcon">üìÖ</small>
                                    <small class="date"
                                           th:text="*{#temporals.format(createdOn, 'dd MMM,yyyy')}"></small>
                                </small>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-8">
                                <small>by <a href="/SMENI">üë§<span class="user" th:text="*{creatorUsername}"></span></a>
                                    at
                                    <span
                                            class="postTime" th:text="*{#temporals.format(createdOn, 'HH:mm')}"></span>
                                    <th:block sec:authorize="isAnonymous()">
                                        (<span
                                            class="totalViews" th:text="*{totalViews}">0</span>üëÄ / <span
                                            class="totalLikes" th:text="*{totalReactions}">0</span>üëç)
                                    </th:block>
                                    <th:block sec:authorize="isAuthenticated()">
                                        <th:block sec:authorize="hasAuthority('MODERATOR')">
                                            (<a href="/SAMO AKO IMA PRAVA"><span
                                                class="totalViews" th:text="*{totalViews}">0</span></a>üëÄ / <a
                                                href="/SAMO AKO IMA PRAVA"><span
                                                class="totalLikes" th:text="*{totalReactions}">0</span></a>üëç)
                                        </th:block>
                                        <th:block sec:authorize="!hasAuthority('MODERATOR')">
                                            (<span
                                                class="totalViews" th:text="*{totalViews}">0</span>üëÄ / <span
                                                class="totalLikes" th:text="*{totalReactions}">0</span>üëç)
                                        </th:block>
                                    </th:block>
                                </small>
                            </div>
                            <div class="col-md-4">
                                <small class="thread-total_comments">
                                    <small>üí¨</small>
                                    <a href="/SMENI"><span class="totalComments" th:text="*{totalComments}"></span></a>
                                    Comments
                                </small>
                            </div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="content" th:id="'content' + ${thread.getId()}">
                            <p class="card-text thread-content" th:utext="*{content}">

                            </p>
                        </div>


                        <div class="row">
                            <div class="col-md-8 thread-random_separation">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="btn-group">
                                    <th:block sec:authorize="isAuthenticated()">
                                        <th:block sec:authorize="hasAuthority('MODERATOR')">
                                            <button class="btn btn-secondary btn-sm dropdown-toggle" type="button"
                                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <small>‚öô</small>
                                                Options
                                            </button>
                                            <div class="dropdown-menu">
                                                <th:block sec:authorize="hasAuthority('ADMIN')">
                                                    <a class="dropdown-item" th:href="@{/thread/{id}/delete(id=*{id})}">
                                                        <small>‚ùå</small>
                                                        Delete</a>
                                                </th:block>
                                            </div>
                                        </th:block>
                                    </th:block>

                                    <button class="btn btn-sm thread-report_button" type="button" id="button-reportThread-readThread">
                                        <small>‚ö†</small>
                                        Report
                                    </button>

                                    <div class="modal" id="modal-reportThread-readThread" role="dialog">
                                        <div class="modal-dialog">

                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h4 class="modal-title">Report to the kings:</h4>
                                                </div>
                                                <form method="post" th:action="@{/thread/{id}/report(id=*{id})}">
                                                    <div class="modal-body">
                                        <textarea class="thread-modal_report-textarea"
                                                  name="reason" placeholder="Reason..."></textarea>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="submit" class="btn btn-default">Report</button>
                                                        <button type="button" class="btn btn-default"
                                                                data-dismiss="modal">
                                                            Cancel
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>

                                        </div>
                                    </div>

                                    <script>
                                        $(document).ready(function () {
                                            $("#button-reportThread-readThread").click(function () {
                                                $("#modal-reportThread-readThread").modal();
                                            });
                                        });
                                    </script>

                                </div>
                                <div class="btn-group thread-right_side_buttons">
                                    <button id="button-commentThread-readThreadPage" class="btn btn-sm" type="button"
                                            aria-haspopup="true" aria-expanded="false">
                                        <small>üí¨</small>
                                        Comment
                                    </button>
                                    <button class="btn btn-sm dropdown-toggle" type="button"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <small>üí°</small>
                                        React
                                    </button>
                                    <div class="dropdown-menu">
                                        <a th:href="@{/thread/{id}/reaction/like(id=*{id})}">
                                            <button class="btn btn-sm thread-right_side_button-like" type="button">
                                                <small>üëçüèª</small>
                                                Like
                                            </button>
                                        </a>
                                        <a th:href="@{/thread/{id}/reaction/dislike(id=*{id})}">
                                            <button class="btn btn-sm" type="button">
                                                <small>üëéüèª</small>
                                                Dislike
                                            </button>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!--Add comment section-->

                <div class="commentBox thread-comment_box">

                    <th:block th:insert="editor/text-editor"></th:block>

                    <div id="textarea-content-createComment"
                         class="thread-comment_box-textarea"
                         contenteditable="true">

                    </div>
                    <div class="row d-flex justify-content-center align-items-center thread-comment_box-buttons">
                        <button id="button-createCommentThread-readThreadPage" class="btn btn-sm" type="button">
                            Comment
                        </button>
                        <button id="button-cancelCommentThread-readThreadPage" class="btn btn-sm thread-comment_box-button_cancel" type="button">
                            Cancel
                        </button>
                    </div>
                </div>

                <script>
                    $(`#button-commentThread-readThreadPage`).on(`click`, function () {
                        $(`.commentBox`).show();
                    });

                    $(`#button-cancelCommentThread-readThreadPage`).on(`click`, function () {
                        $(`.commentBox`).hide();
                    });
                </script>

                <script th:inline="javascript" src="/res/js/thread/create-comment-send.js"/>

                <script src="/res/js/editor/text-editor.js"></script>

                <!--List all comments related to this thread section -->

                <th:block th:each="comment : *{comments}" th:object="${comment}">

                    <div class="card thread-comments">

                        <div>
                            <small class="thread-comments-date_likes_dislikes">
                                <small class="dateIcon">üìÖ</small>
                                <small class="date"
                                       th:text="*{#temporals.format(createdOn, 'dd MMM,yyyy')}"></small>
                            </small>
                            <small class="thread-comments-date_likes_dislikes">
                                <small>üëç</small>
                                <span class="totalComments" th:text="*{totalLikes}">0</span>
                            </small>
                            <small class="thread-comments-date_likes_dislikes">
                                <small>üëé</small>
                                <span class="totalComments" th:text="*{totalDislikes}">0</span>
                            </small>
                        </div>

                        <div class="row">
                            <div class="col-md-3 thread-comment-creator_info_section">
                                <div>
                                    <img class="card-img-top thread-comment-creator_avatar"
                                         src="/res/img/avatar-user.png" alt="Card image cap">
                                </div>
                                <div>
                                    <small>üë§<a href="" th:text="*{creatorUsername}"></a></small>
                                </div>
                                <div>
                                    <small>
                                        <small>üí¨</small>
                                        <span class="totalComments" th:text="*{creatorTotalComments}"></span> total
                                        comments
                                    </small>
                                </div>

                                <div>
                                    <small>
                                        <a href=""><img
                                                        class="card-img-top thread-comment-creator-minecraft_username"
                                                        src="/res/img/avatar-test.png" alt="Card image cap"><span>Minecraft Username</span></a>
                                    </small>
                                </div>
                            </div>

                            <div class="content thread-comment-content">
                                <p class="card-text" th:utext="*{content}">

                                </p>
                            </div>

                        </div>


                        <div>
                            <div class="btn-group thread-comments-buttons">
                                <div class="thread-comments-button_options">
                                    <button class="btn btn-sm dropdown-toggle" type="button"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <small>‚öô</small>
                                        Options
                                    </button>
                                    <div class="dropdown-menu">
                                        <a class="dropdown-item" th:href="@{/comment/{id}/delete(id=*{id})}">
                                            <small>‚ùå</small>
                                            Delete</a>
                                    </div>
                                </div>
                                <div  class="thread-comments-button_report">

                                    <button class="btn btn-sm" type="button" th:id="*{'reportButtonByThreadId-'+id}">
                                        <small>‚ö†</small>
                                        Report
                                    </button>

                                    <div class="modal" th:id="*{'modelReportCommentByThreadId-'+id}" role="dialog">
                                        <div class="modal-dialog">

                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h4 class="modal-title">Report to the kings:</h4>
                                                </div>
                                                <form method="post" th:action="@{/comment/{id}/report(id=*{id})}">
                                                    <div class="modal-body">
                                        <textarea class="thread-comments-modal"
                                                  name="reason" placeholder="Reason..."></textarea>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="submit" class="btn btn-default">Report</button>
                                                        <button type="button" class="btn btn-default" data-dismiss="modal">
                                                            Cancel
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>

                                        </div>
                                    </div>
                                    <script th:inline="javascript">
                                        f();
                                        function f() {
                                            let commentId = /*[[*{id}]]*/ null;
                                            $(document).ready(function () {
                                                $("#reportButtonByThreadId-"+commentId).click(function () {
                                                    $("#modelReportCommentByThreadId-"+commentId).modal();
                                                });
                                            });
                                        }
                                    </script>

                                </div>
                                <div class="thread-comments-button_options">
                                    <button class="btn btn-sm dropdown-toggle" type="button"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <small>üí°</small>
                                        React
                                    </button>
                                    <div class="dropdown-menu">
                                        <a th:href="@{/comment/{id}/reaction/like(id=*{id})}">
                                            <button class="btn btn-sm thread-right_side_button-like" type="button">
                                                <small>üëçüèª</small>
                                                Like
                                            </button>
                                        </a>
                                        <a th:href="@{/comment/{id}/reaction/dislike(id=*{id})}">
                                            <button class="btn btn-sm" type="button">
                                                <small>üëéüèª</small>
                                                Dislike
                                            </button>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </th:block>

            </div>
        </th:block>

    </div>
</div>

<!--Clear the keyword SHOW_TO_NOW-->

<script>
    $(`<script/>`, {type: 'text/javascript', src: '/res/js/thread/thread-substringer.js'}).appendTo('head');

    removeHtmlClassContentKyWord('.thread-content','SHOW_TO_NOW');
</script>


<!--Inserting the image fitter which will resize images to fit them into their container-->

<script>
    $(document).ready(function () {
        $(`<script/>`, {type: 'text/javascript', src: '/res/js/utils/imageFitter.js'}).appendTo('head');
    });
</script>

