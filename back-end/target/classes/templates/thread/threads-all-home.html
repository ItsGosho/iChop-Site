<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">

<link rel="stylesheet" href="/res/css/thread/threads-all-home.css">

<div id="threads" class="col-xs-6">
    <div class="card">
        <div class="card-header">
            <small>üì∞</small>
            News:
        </div>
        <th:block th:if="${!#lists.isEmpty(threads)}">

            <th:block th:each="thread : ${threads}" th:object="${thread}">
                <div th:id="*{id}" class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h3 class="title" th:text="*{title}">...</h3>
                        </div>
                        <div class="col-md-4">
                            <small class="date">
                                <small class="dateIcon">üìÖ</small>
                                <small th:text="*{#temporals.format(createdOn, 'dd MMM,yyyy')}">1 Jan,1970</small>
                            </small>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-8">
                            <small>by <a href="/SMENI">üë§<span class="user" th:text="*{creatorUsername}"></span></a> at
                                <span
                                        class="postTime" th:text="*{#temporals.format(createdOn, 'HH:mm')}"></span>
                                <th:block sec:authorize="isAnonymous()">
                                    (<span
                                        class="totalViews" th:text="*{totalViews}">0</span>üëÄ / <span
                                        class="totalLikes" th:text="*{totalReactions}">0</span>üëç)
                                </th:block>
                                <th:block sec:authorize="isAuthenticated()">
                                    <th:block sec:authorize="hasAuthority('MODERATOR')">
                                        (<a href="/SAMO AKO IMA PRAVA"><span
                                            class="totalViews" th:text="*{totalViews}">0</span></a>üëÄ / <a href="/SAMO AKO IMA PRAVA"><span
                                            class="totalLikes" th:text="*{totalReactions}">0</span></a>üëç)
                                    </th:block>
                                    <th:block sec:authorize="!hasAuthority('MODERATOR')">
                                        (<span
                                            class="totalViews" th:text="*{totalViews}">0</span>üëÄ / <span
                                            class="totalLikes" th:text="*{totalReactions}">0</span>üëç)
                                    </th:block>
                                </th:block>
                            </small>
                        </div>
                        <div class="col-md-4">
                            <small class="totalComments">
                                <small>üí¨</small>
                                <a href="/SMENI"><span th:text="*{totalComments}"></span></a> Comments
                            </small>
                        </div>
                    </div>
                    <div class="dropdown-divider"></div>

                    <div class="content" th:id="'content' + ${thread.getId()}">
                        <p class="card-text" th:utext="${thread.getContent()}">

                        </p>
                    </div>

                    <!--

                    Substrings the content of the thread only to SHOW_TO_NOW!

                    -->

                    <script th:inline="javascript">
                        proceed();
                        function proceed() {

                            let content = $(`#content`+ [[${thread.getId()}]])[0].innerHTML;
                            let substringedContent = content.substring(0,content.indexOf('SHOW_TO_NOW'));
                            let isFound = substringedContent !== '';

                            if(isFound){
                                $(`#content`+[[${thread.getId()}]]).empty();

                                $(`#content`+[[${thread.getId()}]]).append(substringedContent);
                            }
                        }
                    </script>

                    <div class="dropdown-divider"></div>

                    <div class="row">
                        <div class="col-md-8">
                            <div class="btn-group">
                                <th:block sec:authorize="isAuthenticated()">
                                    <th:block sec:authorize="hasAuthority('MODERATOR')">
                                        <button class="btn btn-secondary btn-sm dropdown-toggle" type="button"
                                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <small>‚öô</small>
                                            Options
                                        </button>
                                        <div class="dropdown-menu">
                                            <th:block sec:authorize="hasAuthority('ADMIN')">
                                                <a class="dropdown-item" th:href="@{/thread/{id}/delete(id=*{id})}">
                                                    <small>‚ùå</small>
                                                    Delete</a>
                                            </th:block>
                                        </div>
                                    </th:block>
                                </th:block>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <a class="dropdown-item" th:href="@{/thread/{id}/read(id=*{id})}">
                                <button  type="button"
                                        class="btn btn-primary btn-sm btn-brand btn-reddit continueReading">
                                    <small>üìñ</small>
                                    Continue reading...
                                </button>
                            </a>
                        </div>

                    </div>
                    <div class="dropdown-divider"></div>
                </div>
            </th:block>

            <nav aria-label="Page navigation example" class="d-flex justify-content-center align-items-center">
                <ul class="pagination">

                    <th:block th:if="${#request.getParameter('page')} != null">

                        <th:block th:if="${(#conversions.convert(#request.getParameter('page'), 'Integer')) - 1} >= 0">
                            <li class="page-item"><a class="page-link" th:href="@{/(page=${(#conversions.convert(#request.getParameter('page'), 'Integer')) - 1})}">Previous</a></li>
                        </th:block>

                    </th:block>

                    <th:block th:each="i: ${#numbers.sequence(1,totalPages)}">
                        <li class="page-item"><a class="page-link" th:text="${i}" th:href="@{/?page={pId}(pId=${i-1})}"></a></li>
                    </th:block>


                    <th:block th:if="${#request.getParameter('page')} != null">

                        <th:block th:if="${(#conversions.convert(#request.getParameter('page'), 'Integer')) + 1 <= totalPages-1}">
                            <li class="page-item"><a class="page-link" th:href="@{/(page=${(#conversions.convert(#request.getParameter('page'), 'Integer')) + 1})}">Next</a></li>
                        </th:block>

                    </th:block>


                </ul>
            </nav>


            <div class="dropdown-divider"></div>

        </th:block>

        <th:block th:if="${#lists.isEmpty(threads)}">
            There are no news!
        </th:block>

    </div>
</div>

<script src="/res/js/utils/imageFitter.js"/>